<div class="dashboard-wrapper">
  <!-- Top Header -->
  <header class="main-header">
    <div class="header-left">
      <div class="logo-container">
        <img src="assets/logo.jpeg" alt="Logo" class="logo-img">
        <div class="logo">CANADA CONSEIL GROUPE</div>
      </div>
      <div class="divider"></div>
      <button class="icon-btn" routerLink="/dashboard/planning" title="Planning">
        <i class="fas fa-calendar-alt"></i>
      </button>
      <button class="icon-btn" routerLink="/dashboard" title="Home">
        <i class="fas fa-home"></i>
      </button>
      <div class="notif-container">
        <button class="icon-btn notif-btn" title="Notifications" (click)="toggleNotifDropdown()">
          <i class="fas fa-bell"></i>
          <span class="notif-dot" *ngIf="unreadCount > 0">{{ unreadCount }}</span>
        </button>

        <!-- Notifications Dropdown -->
        <div class="notifications-dropdown" *ngIf="showNotifDropdown">
          <div class="dropdown-header">
            <span>Notifications</span>
            <button (click)="markAllAsRead()" *ngIf="unreadCount > 0">Marquer tout comme lu</button>
          </div>
          <div class="dropdown-body">
            <div *ngIf="notifications.length === 0" class="empty-notif">
              Aucune notification
            </div>
            <div *ngFor="let n of notifications" class="notif-item" [class.unread]="!n.isRead" (click)="markAsRead(n)">
              <div class="notif-icon">
                <i class="fas fa-info-circle text-primary"></i>
              </div>
              <div class="notif-content">
                <p>{{ n.content }}</p>
                <small>{{ n.createdAt | date:'short' }}</small>
              </div>
              <div class="unread-indicator" *ngIf="!n.isRead"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="header-right">
      <div class="search-box">
        <select>
          <option>Organisations</option>
          <option>Ressources</option>
          <option>Risques</option>
          <option>Incidents</option>
          <option>Contrôles</option>
          <option>Actions</option>
        </select>
        <input type="text" placeholder="Saisir un texte">
        <i class="fas fa-search"></i>
      </div>
      <div class="user-info">
        <i class="fas fa-user-circle"></i>
        <span>{{ currentUserName }}</span>
      </div>
      <button class="logout-btn" (click)="logout()" title="Déconnexion">
        <i class="fas fa-power-off"></i>
      </button>
    </div>
  </header>

  <!-- Sub Navigation -->
  <nav class="sub-nav">
    <a href="javascript:void(0)">Organisation</a>
    <a href="javascript:void(0)">Ressource</a>
    <a href="javascript:void(0)">Risque</a>
    <a href="javascript:void(0)">Incident</a>
    <a href="javascript:void(0)">Contrôle</a>
    <a href="javascript:void(0)">Action</a>
  </nav>

  <!-- Content Area -->
  <main class="content-area">

    <div class="dashboard-content">
      <router-outlet></router-outlet>
    </div>

    <app-modal *ngIf="modalVisible && !creating" [title]="modalTitle" (close)="closeModal()">
      <div modal-body [innerHTML]="modalBody"></div>
      <div modal-footer>
        <button (click)="startCreate()">Créer</button>
      </div>
      <!-- mark projected content for modal detection -->
      <div #projected style="display:none"></div>
    </app-modal>

    <app-modal *ngIf="modalVisible && creating" [title]="modalTitle" (close)="closeModal()">
      <div modal-body>
        <h4>Créer une configuration — {{ currentSubmoduleTitle }}</h4>
        <div class="form-row">
          <label>Nom</label>
          <input [(ngModel)]="form.name" />
        </div>
        <div class="form-row">
          <label>Description</label>
          <textarea rows="3" [(ngModel)]="form.description"></textarea>
        </div>
        <div class="form-row">
          <label>Configuration (JSON)</label>
          <textarea rows="8" [(ngModel)]="form.config"></textarea>
        </div>
      </div>
      <div modal-footer>
        <button (click)="submitForm()">Créer</button>
        <button (click)="closeModal()">Annuler</button>
      </div>
      <div #projected style="display:none"></div>
    </app-modal>

  </main>
</div>

<!-- AI Assistant -->
<app-ai-assistant></app-ai-assistant>